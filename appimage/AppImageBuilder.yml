version: 1

script:
  # Remove previous build
  - rm -rf AppDir || true
  # Create AppDir structure
  - mkdir -p AppDir/usr/bin
  - mkdir -p AppDir/usr/lib
  - mkdir -p AppDir/usr/share/applications
  - mkdir -p AppDir/usr/share/icons/hicolor/scalable/apps
  # Copy the Flutter build
  - cp -r ../build/linux/x64/release/bundle/* AppDir/usr/bin/
  # Copy backend
  - mkdir -p AppDir/usr/bin/backend
  - cp ../typescript/galaxi-backend AppDir/usr/bin/backend/
  - chmod +x AppDir/usr/bin/backend/galaxi-backend
  # Copy AppRun script
  - cp AppRun.sh AppDir/AppRun
  - chmod +x AppDir/AppRun
  - cp ../galaxi-run AppDir/galaxi-run
  # Copy desktop file and icon
  - cp ../galaxi.desktop AppDir/usr/share/applications/
  - cp ../galaxi.svg AppDir/usr/share/icons/hicolor/scalable/apps/galaxi.svg
  - cp ../galaxi.svg AppDir/galaxi.svg
  - cp ../galaxi.desktop AppDir/galaxi.desktop

AppDir:
  path: ./AppDir

  app_info:
    id: io.github.mar0xy.galaxi
    name: Galaxi
    icon: galaxi
    version: latest
    exec: galaxi-run

  apt:
    arch: amd64
    sources:
      - sourceline: 'deb [arch=amd64] https://archive.ubuntu.com/ubuntu/ jammy main restricted universe multiverse'
        key_url: 'https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x871920D1991BC93C'
    
    include:
      - libgtk-3-0
      - libglib2.0-0
      - libgdk-pixbuf2.0-0
      - libcairo2
      - libpango-1.0-0
      - libsqlite3-0
      - libc6
      - libstdc++6
      - libgcc-s1

  files:
    exclude:
      - usr/share/man
      - usr/share/doc/*/README.*
      - usr/share/doc/*/changelog.*
      - usr/share/doc/*/NEWS.*
      - usr/share/doc/*/TODO.*

AppImage:
  arch: x86_64
